<html>
<!-- CSS -->
<link rel="stylesheet" href="static/css/bootstrap.min.css">
<!-- <link rel="stylesheet" href="/static/css/custom.css"> -->

<!-- General Scripts -->
<script src="static/js/jquery-3.4.1.min.js"></script>
<script src="static/js/bootstrap.bundle.min.js"></script>

<script>
    const expression = /OverrideNamedEngramEntries=(.*)/g;

    function setupHides(hideInput) {
        if (!hideInput) {
            return []
        }

        var engramsToHide = hideInput.split("\n");

        var engramsToHideRe = []
        engramsToHide.forEach(function(eHide) {
            engramsToHideRe.push(new RegExp(eHide))
        })

        return engramsToHide
    }

    function filterEngrams(serverEngrams, engramRE) {
        var postParse = []
        serverEngrams.forEach(function(sEngram) {
            var match = engramsToHideRe.some(function(eHideRe, index) {
                if (sEngram.match(eHideRe)) {
                    return true;
                } else {
                    return false
                }
            })

            if (!match) {
                postParse.push(sEngram)
            }
        })

        postParse.sort()
        return postParse.join("\n")
    }

    function parseServerOutput() {
        var serverOutput = document.getElementById("serverOutput").value
        var serverEngrams = serverOutput.match(expression)

        if (!serverEngrams) {
            alert("Invalid server output input.")
            return
        }

        let toHide = document.getElementById("toHide")
        toHide.value = toHide.value.split("\n").sort().join("\n")
        toHide = toHide.value
        engramsToHideRe = setupHides(toHide)

        postParse = filterEngrams(serverEngrams, engramsToHideRe)

        if (document.getElementById("noLevels").checked) {
            postParse = postParse.replace(/(EngramLevelRequirement=)\d*/g, "$10")
        }

        if (document.getElementById("noCost").checked) {
            postParse = postParse.replace(/(EngramPointsCost=)\d*/g, "$10")
        }

        if (document.getElementById("noPreReqs").checked) {
            postParse = postParse.replace(/(RemoveEngramPreReq=)false/g, "$1true")
        }

        document.getElementById("postParse").value = postParse
        $('#myTabs a[href="#output"]').tab('show')
    }

    // function duplicateInputBoxs(id) {
        // let ele = document.getElementById(id)
        // let clone = ele.cloneNode(true)
        // clone.setAttribute( 'id', newId );
    // }
</script>
<br>
<div class="form-horizontal">
    <div class="form-group">
        <div class="col-auto">
            <!-- Tabs -->
            <ul class="nav nav-tabs" id="myTabs">
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="tab" href="#inputs">Inputs</a>
                </li>
<!--                 <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#levelmods">Level mods</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#costmods">Cost mods</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#prereqsmods">Pre-Requirements mods</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#findreplace">Find and Replace</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#eximport">Export/Import</a>
                </li> -->
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#output">Outputs</a>
                </li>
                <li class="nav-item ml-auto">
                    <a class="nav-link" data-toggle="tab" href="#about">About</a>
                </li>
            </ul>
            <div id="myTabContent" class="tab-content">
                <div class="tab-pane fade active show" id="inputs">
                    <form action="javascript:parseServerOutput()">
                        <!-- Server output -->
                        <label class="col-form-label col-form-label-lg" for="serverOutput">Server output:</label>
                        <textarea class="form-control" rows="10" required id="serverOutput"></textarea>
                        <br>

                        <!-- Engrams to hide -->
                        <label class="col-form-label col-form-label-lg" for="toHide">Engrams to hide (newline seperated) (regex):</label>
                        <textarea class="form-control" rows="10" placeholder="&quot;EngramEntry_Bow_C&quot;&#13;&#10;&quot;EngramEntry_WeaponWhip_C&quot;" id="toHide"></textarea>
                        <br>

                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="noLevels"/>
                            <label class="custom-control-label" for="noLevels">Remove Level Requirements</label>
                        </div>

                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="noCost"/>
                            <label class="custom-control-label" for="noCost">Remove Point Cost</label>
                        </div>

                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="noPreReqs"/>
                            <label class="custom-control-label" for="noPreReqs">Remove Pre-Requirements</label>
                        </div>
                        <br>

                        <!-- Submit button -->
                        <input type="submit" value="Submit">
                    </form>
                </div>


<!--                 <div class="tab-pane fade" id="levelmods">
                    <label class="col-form-label col-form-label-lg">Engram (regex)</label>
                    <form action="javascript:parseServerOutput()">
                        <div class="input-group w-50" id="levelmodsinputs">
                            <input type="text" class="form-control" placeholder="&quot;EngramEntry_Bow_C&quot;"></div>
                            <span class="input-group-addon"></span>
                            <input type="text" class="form-control" placeholder="50"/>
                        </div>
                    </form>
                    <button class="btn btn-primary" onclick="()"></button>
                </div>

                <div class="tab-pane fade" id="costmods">
                </div>

                <div class="tab-pane fade" id="prereqsmods">

                </div>

                <div class="tab-pane fade" id="findreplace">
                    
                </div>

                <div class="tab-pane fade" id="eximport">
                    
                </div> -->

                <div class="tab-pane fade" id="output">
                    <!-- Post process read only textbox -->
                    <label class="col-form-label col-form-label-lg" for="postParse">Post processing:</label>
                    <textarea class="form-control" rows="27" id="postParse" readonly=""></textarea>
                </div>

                <div class="tab-pane fade w-50 p-5" id="about">
                    <h1 style="text-decoration: underline;">About</h1>
                    <p>
                        This website was developed primarily for use with my <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=2100040774">GetEngrams (Engram hider utility)</a> ARK: Survival Evolved mod. The value over using the GetEngrams mod is that it results in a lag-free method of hiding/modifying engrams. Only issue with this method is that it is a whitelist-style technique, and getting a list of all engrams prior to this mod was VERY tedious. GetEngrams plus this website will allow a server administrator to have full control over all engram settings for their server.
                    </p>
                    <br>
                    <p>
                        The end goal of the website is to be a one stop shop for all engram modifications that a server administrator could want.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
</html>